(this.webpackJsonp=this.webpackJsonp||[]).push([["releva-retargeting"],{"6Xru":function(e,t,n){},BQwF:function(e,t){const{Mixin:n,Application:a}=Shopware;n.register("releva-notification",{mixins:[n.getByName("notification")],methods:{handleNotifications(e){var t,n,r=a.getApplicationRoot();for(var i in e)"string"==typeof r.$t("releva-retargeting.messages."+e[i].code)?(t=r.$t("releva-retargeting.messages.fallback.title",{title:e[i].message}),n=r.$t("releva-retargeting.messages.fallback.message",{code:e[i].code,data:JSON.stringify(e[i].data)})):(t=r.$t("releva-retargeting.messages."+e[i].code+".title",e[i].data),n=r.$t("releva-retargeting.messages."+e[i].code+".message",e[i].data)),this.createNotification({title:t,message:n,variant:e[i].variant})},handleAjaxErrors(e){if(e&&e.errors){var t=a.getApplicationRoot();e.errors.forEach((e=>{this.createNotification({title:t.$t("releva-retargeting.messages.ajax.title"),message:t.$t("releva-retargeting.messages.ajax.message",e),variant:"error"})}))}}}})},CT86:function(e,t,n){var a=n("G3jd");"string"==typeof a&&(a=[[e.i,a,""]]),a.locals&&(e.exports=a.locals);(0,n("SZ7m").default)("78d0c26c",a,!0,{})},CkOj:function(e,t,n){"use strict";n.d(t,"a",(function(){return c}));var a=n("lSNA"),r=n.n(a),i=n("lO2t"),s=n("lYO9");function l(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?l(Object(n),!0).forEach((function(t){r()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):l(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function c(e){var t=function(e){var t;if(i.a.isString(e))try{t=JSON.parse(e)}catch(e){return!1}else{if(!i.a.isObject(e)||i.a.isArray(e))return!1;t=e}return t}(e);if(!t)return null;if(!0===t.parsed||!function(e){return void 0!==e.data||void 0!==e.errors||void 0!==e.links||void 0!==e.meta}(t))return t;var n=function(e){var t={links:null,errors:null,data:null,associations:null,aggregations:null};if(e.errors)return t.errors=e.errors,t;var n=function(e){var t=new Map;if(!e||!e.length)return t;return e.forEach((function(e){var n="".concat(e.type,"-").concat(e.id);t.set(n,e)})),t}(e.included);if(i.a.isArray(e.data))t.data=e.data.map((function(e){var a=u(e,n);return Object(s.g)(a,"associationLinks")&&(t.associations=o(o({},t.associations),a.associationLinks),delete a.associationLinks),a}));else if(i.a.isObject(e.data)){var a=u(e.data,n);Object.prototype.hasOwnProperty.call(a,"associationLinks")&&(t.associations=o(o({},t.associations),a.associationLinks),delete a.associationLinks),t.data=a}else t.data=null;e.meta&&Object.keys(e.meta).length&&(t.meta=g(e.meta));e.links&&Object.keys(e.links).length&&(t.links=e.links);e.aggregations&&Object.keys(e.aggregations).length&&(t.aggregations=e.aggregations);return t}(t);return n.parsed=!0,n}function u(e,t){var n={id:e.id,type:e.type,links:e.links||{},meta:e.meta||{}};if(e.attributes&&Object.keys(e.attributes).length>0){var a=g(e.attributes);n=o(o({},n),a)}if(e.relationships){var r=function(e,t){var n={},a={};return Object.keys(e).forEach((function(r){var s=e[r];if(s.links&&Object.keys(s.links).length&&(a[r]=s.links.related),s.data){var l=s.data;i.a.isArray(l)?n[r]=l.map((function(e){return f(e,t)})):i.a.isObject(l)?n[r]=f(l,t):n[r]=null}})),{mappedRelations:n,associationLinks:a}}(e.relationships,t);n=o(o(o({},n),r.mappedRelations),{associationLinks:r.associationLinks})}return n}function g(e){var t={};return Object.keys(e).forEach((function(n){var a=e[n],r=n.replace(/-([a-z])/g,(function(e,t){return t.toUpperCase()}));t[r]=a})),t}function f(e,t){var n="".concat(e.type,"-").concat(e.id);return t.has(n)?u(t.get(n),t):e}},EZlk:function(e,t){e.exports='{% block sw_text_field %}\n    {% block releva_config_check_api_button %}\n        <template v-if="salesChannel">\n            <sw-contextual-field v-bind="$attrs" :name="formFieldName">\n                <template #sw-field-input="{identification, error, disabled, size, setFocusClass, removeFocusClass }">\n                    <input\n                        :name="identification"\n                        :id="identification"\n                        :value="currentValue"\n                        :placeholder="placeholder"\n                        :disabled="disabled"\n                        @input="onInput"\n                        @change="onChange"\n                        @focus="setFocusClass"\n                        @blur="removeFocusClass">\n                </template>\n                <template #sw-contextual-field-suffix="{ disabled }">\n                    <span @click="changeMode(disabled)" class="releva-config-check-api-button-button">\n                        <span v-if="buttonText" class="releva-config-check-api-button-button-text">{{buttonText}}</span>\n                        <sw-icon v-if="buttonIcon" class="releva-config-check-api-button-button-icon" :color="buttonIcon.color" :name="buttonIcon.name" :small="true"></sw-icon>\n                    </span>\n                </template>\n            </sw-contextual-field>\n        </template>\n        <template v-else>\n            {{ scopeMessage }}\n        </template>\n    {% endblock %}\n{% endblock %}'},G3jd:function(e,t,n){},O1Uz:function(e){e.exports=JSON.parse('{"releva-retargeting":{"general":{"mainMenuItemGeneral":"releva.nz retargeting"},"config":{"relevanzApiKey":{"button":"API-Zugangsdaten testen"},"relevaSalesChannelSwitch":{"label":"Storefront-Verkaufskanal"}},"messages":{"1553935480":{"title":"Kann keine Verbindung zum releva.nz API-Server herstellen.","message":"salesChannel: {salesChannelName}, data: {data}"},"1553935569":{"title":"@:(releva-retargeting.messages.1553935786.title)","message":"@:(releva-retargeting.messages.1553935786.message)"},"1553935786":{"title":"Ihr API Key für releva.nz und Verkaufskanal \\"{salesChannelName}\\" ist fehlerhaft.","message":"<a href=\\"#/sw/plugin/settings/RelevaRetargeting\\">Konfiguriere Plugin hier.</a>"},"1579084006":{"title":"Es wurde kein Verkaufskanal für das releva.nz Plugin konfiguriert.","message":"Noch nicht registriert? <a href=\\"https://releva.nz\\" target=\\"blank\\">Jetzt nachholen.</a> Bereits registriert? <a href=\\"#/sw/plugin/settings/RelevaRetargeting\\">Konfiguriere Plugin hier.</a>"},"1579849966":{"title":"Verkaufskanal hat keine Domain.","message":"Verkaufskanal <a href=\\"#/sw/sales/channel/detail/{salesChannelId}\\">{salesChannelName}</a> benötigt eine Domain für den releva.nz Produktexport."},"ajax":{"title":"@:(releva-retargeting.general.mainMenuItemGeneral) hat einen Fehler verursacht","message":"{title}: {detail}"},"fallback":{"title":"{title}","message":"code: {code}, data: {data}"}}}}')},OOCV:function(e,t){e.exports='{% block sw_system_config_content_card_field %}\n    <template v-if="isDefaultSalesChannelOrGlobalScope(element)">\n        {% parent() %}\n    </template>\n    <template v-else>\n        <sw-inherit-wrapper v-model="actualConfigData[currentSalesChannelId][element.name]"\n                            v-bind="getInheritWrapperBind(element)"\n                            :hasParent="false"\n                            :inheritedValue="getInheritedValue(element)"\n                            :class="\'sw-system-config--field-\' + kebabCase(getElementBind(element).name)">\n            <template #content="props">\n                <sw-form-field-renderer v-bind="getElementBind(element, props)"\n                                        :disabled="props.isInherited"\n                                        :value="props.currentValue"\n                                        :key="props.isInheritField + props.isInherited"\n                                        @input="props.updateCurrentValue"\n                                        @change="props.updateCurrentValue">\n                </sw-form-field-renderer>\n            </template>\n        </sw-inherit-wrapper>\n    </template>\n{% endblock %}'},SwDr:function(e,t,n){"use strict";n.r(t);n("BQwF");var a=n("nKaH"),r=n.n(a);n("sipW");const{Component:i,Mixin:s}=Shopware;i.register("releva-retargeting-statistic",{template:r.a,inject:["retargetingApiService"],mixins:[s.getByName("releva-notification")],metaInfo(){return{title:this.$createTitle()}},data:()=>({currentIframeUrl:null,salesChannelsToIframeUrl:null}),created(){this.retargetingApiService.getInvolvedSalesChannelsToIframeUrls().then((e=>{this.handleNotifications(e.notifications),this.salesChannelsToIframeUrl=e.data,this.onSalesChannelsToIframeUrlSelectionChange(this.salesChannelsToIframeUrl[0].iframeUrl)})).catch((({response:{data:e}})=>{this.handleAjaxErrors(e)}))},methods:{onSalesChannelsToIframeUrlSelectionChange(e){this.currentIframeUrl=e}}});var l=n("EZlk"),o=n.n(l);n("CT86");const{Component:c,Mixin:u}=Shopware;c.extend("releva-config-check-api-button","sw-text-field",{template:o.a,inheritAttrs:!1,mixins:[u.getByName("releva-notification")],inject:["retargetingApiService"],data(){return{checkApiState:"unchecked",buttonText:(e=this,t="releva-retargeting"+e.$attrs.name.substr(e.$attrs.name.indexOf("."))+".button",n=e.$tc(t),t!==n&&n),salesChannel:function(e){for(var t=e;void 0!==t.$parent;)if(void 0!==(t=t.$parent).currentSalesChannelId)return t.currentSalesChannelId;return""}(this),scopeMessage:this.$attrs.scopeMessage};var e,t,n},computed:{buttonIcon(){switch(this.checkApiState){case"success":return{name:"default-basic-checkmark-circle",color:"green"};case"error":return{name:"default-badge-error",color:"red"};case"checking":return{name:"default-web-loading-circle",color:"gray"};default:return{name:"default-action-cloud-upload",color:"silver"}}}},methods:{changeMode(e){if(!e){this.checkApiState="checking";var t=this;this.retargetingApiService.getVerifyApiKey({apiKey:void 0!==this.currentValue?this.currentValue.trim():"",salesChannel:function(e){for(;void 0!==e.$parent;)if(void 0!==(e=e.$parent).currentSalesChannelId)return e.currentSalesChannelId;return""}(this)}).then((e=>{t.checkApiState=null===e.data.userId?"error":"success",this.handleNotifications(e.notifications)})).catch((({response:{data:e}})=>{t.checkApiState="unchecked",t.handleAjaxErrors(e)}))}}}});var g=n("OOCV"),f=n.n(g);const{Component:h,Defaults:p,Mixin:d,State:v}=Shopware,{Criteria:m}=Shopware.Data;h.override("sw-system-config",{template:f.a,inject:["retargetingApiService"],mixins:[d.getByName("releva-notification")],watch:{currentSalesChannelId(){this.readConfig()},config(){if("RelevaRetargeting.config"===this.domain)for(var e of this.config){for(var t of e.elements)!this.currentSalesChannelId&&t.config.hasOwnProperty("scope")&&"global"!==t.config.scope?e.elements=e.elements.filter((function(e){return t!==e})):t.config.disabled=!!t.config.hasOwnProperty("disabled")&&t.config.disabled;0===e.elements.length&&(this.config=this.config.filter((function(t){return e!==t})))}}},methods:{saveAll(){return this.isLoading=!0,"RelevaRetargeting.config"===this.domain&&this.currentSalesChannelId?this.retargetingApiService.getVerifyApiKey({apiKey:this.actualConfigData[this.currentSalesChannelId]["RelevaRetargeting.config.relevanzApiKey"],salesChannel:this.currentSalesChannelId,save:!0}).then((e=>(this.actualConfigData.hasOwnProperty(this.currentSalesChannelId)&&(this.actualConfigData[this.currentSalesChannelId]["RelevaRetargeting.config.relevanzUserId"]=e.data.userId),this.handleNotifications(e.notifications),this.$super("saveAll")))).catch((({response:{data:e}})=>(this.handleAjaxErrors(e),this.$super("saveAll")))).finally((()=>this.isLoading=!1)):this.$super("saveAll")},isDefaultSalesChannelOrGlobalScope(e){return"RelevaRetargeting.config"!==this.domain||!(e.config.hasOwnProperty("scopeMessage")||e.config.hasOwnProperty("scope")&&"global"!==e.config.scope)}}});var b=n("SwLI");class y extends b.default{constructor(e,t,n="/releva/retargeting"){super(e,t,n)}getInvolvedSalesChannelsToIframeUrls(e){const t=`${this.getApiBasePath()}/getInvolvedSalesChannelsToIframeUrls`;return this.httpClient.post(t,{config:e},{headers:this.getBasicHeaders()}).then((e=>b.default.handleResponse(e)))}getVerifyApiKey(e){const t=`${this.getApiBasePath()}/getVerifyApiKey`;return this.httpClient.post(t,{config:e},{headers:this.getBasicHeaders()}).then((e=>b.default.handleResponse(e)))}}var k=y;const{Application:O}=Shopware;O.addServiceProvider("retargetingApiService",(e=>{const t=O.getContainer("init");return new k(t.httpClient,e.loginService)}));var C=n("O1Uz"),S=n("Xwpa");const{Module:w}=Shopware;w.register("releva-retargeting",{type:"plugin",name:"relevanz-retargeting",title:"releva-retargeting.general.mainMenuItemGeneral",favicon:"../../../../../relevaretargeting/administration/static/img/favicon/modules/icon-module-releva-retargeting.png",snippets:{"de-DE":C,"en-GB":S},routes:{statistic:{component:"releva-retargeting-statistic",path:"statistic"}},navigation:[{label:"releva-retargeting.general.mainMenuItemGeneral",path:"releva.retargeting.statistic",parent:"sw-marketing"}]})},SwLI:function(e,t,n){"use strict";n.r(t);var a=n("lwsE"),r=n.n(a),i=n("W8MJ"),s=n.n(i),l=n("CkOj"),o=function(){function e(t,n,a){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"application/vnd.api+json";r()(this,e),this.httpClient=t,this.loginService=n,this.apiEndpoint=a,this.contentType=i}return s()(e,[{key:"getApiBasePath",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n="";return t&&t.length&&(n+="".concat(t,"/")),e&&e.length>0?"".concat(n).concat(this.apiEndpoint,"/").concat(e):"".concat(n).concat(this.apiEndpoint)}},{key:"getBasicHeaders",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t={Accept:this.contentType,Authorization:"Bearer ".concat(this.loginService.getToken()),"Content-Type":"application/json"};return Object.assign({},t,e)}},{key:"apiEndpoint",get:function(){return this.endpoint},set:function(e){this.endpoint=e}},{key:"httpClient",get:function(){return this.client},set:function(e){this.client=e}},{key:"contentType",get:function(){return this.type},set:function(e){this.type=e}}],[{key:"handleResponse",value:function(t){if(null===t.data||void 0===t.data)return t;var n=t.data,a=t.headers;return a&&a["content-type"]&&"application/vnd.api+json"===a["content-type"]&&(n=e.parseJsonApiData(n)),n}},{key:"parseJsonApiData",value:function(e){return Object(l.a)(e)}},{key:"getVersionHeader",value:function(e){return{"sw-version-id":e}}}]),e}();t.default=o},Xwpa:function(e){e.exports=JSON.parse('{"releva-retargeting":{"general":{"mainMenuItemGeneral":"releva.nz retargeting"},"config":{"relevanzApiKey":{"button":"Check API-Access"},"relevaSalesChannelSwitch":{"label":"Storefront-sales-channel"}},"messages":{"1553935480":{"title":"Unable to connect to releva.nz API-Server.","message":"salesChannel: {salesChannelName}, data: {data}"},"1553935569":{"title":"@:(releva-retargeting.messages.1553935786.title)","message":"@:(releva-retargeting.messages.1553935786.message)"},"1553935786":{"title":"The API key for sales-channel \\"{salesChannelName}\\" cannot be verified. Please make sure that the API key is correct.","message":"<a href=\\"#/sw/plugin/settings/RelevaRetargeting\\">Configure plugin here.</a>"},"1579084006":{"title":"No sales-channels are configured for releva.nz plugin.","message":"Not yet registered? <a href=\\"https://releva.nz\\" target=\\"blank\\">Now catch up.</a> Already registered? <a href=\\"#/sw/plugin/settings/RelevaRetargeting\\">Configure plugin here.</a>"},"1579849966":{"title":"Sales-channel doesn\'t have domain.","message":"Sales-channel <a href=\\"#/sw/sales/channel/detail/{salesChannelId}\\">{salesChannelName}</a> need a domain for the releva.nz article export."},"ajax":{"title":"@:(releva-retargeting.general.mainMenuItemGeneral) produced a error","message":"{title}: {detail}"},"fallback":{"title":"{title}","message":"code: {code}, data: {data}"}}}}')},lO2t:function(e,t,n){"use strict";n.d(t,"b",(function(){return j}));var a=n("GoyQ"),r=n.n(a),i=n("YO3V"),s=n.n(i),l=n("E+oP"),o=n.n(l),c=n("wAXd"),u=n.n(c),g=n("Z0cm"),f=n.n(g),h=n("lSCD"),p=n.n(h),d=n("YiAA"),v=n.n(d),m=n("4qC0"),b=n.n(m),y=n("Znm+"),k=n.n(y),O=n("Y+p1"),C=n.n(O),S=n("UB5X"),w=n.n(S);function j(e){return void 0===e}t.a={isObject:r.a,isPlainObject:s.a,isEmpty:o.a,isRegExp:u.a,isArray:f.a,isFunction:p.a,isDate:v.a,isString:b.a,isBoolean:k.a,isEqual:C.a,isNumber:w.a,isUndefined:j}},lYO9:function(e,t,n){"use strict";n.d(t,"h",(function(){return k})),n.d(t,"i",(function(){return O})),n.d(t,"a",(function(){return C})),n.d(t,"d",(function(){return S})),n.d(t,"k",(function(){return w})),n.d(t,"j",(function(){return j})),n.d(t,"g",(function(){return I})),n.d(t,"b",(function(){return A})),n.d(t,"c",(function(){return P})),n.d(t,"f",(function(){return x})),n.d(t,"e",(function(){return N}));var a=n("lSNA"),r=n.n(a),i=n("QkVN"),s=n.n(i),l=n("JBE3"),o=n.n(l),c=n("BkRI"),u=n.n(c),g=n("mwIZ"),f=n.n(g),h=n("D1y2"),p=n.n(h),d=n("JZM8"),v=n.n(d),m=n("lO2t");function b(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function y(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?b(Object(n),!0).forEach((function(t){r()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):b(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}s.a,s.a,u.a,f.a,p.a,v.a;var k=s.a,O=o.a,C=u.a,S=f.a,w=p.a,j=v.a;function I(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function A(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return JSON.parse(JSON.stringify(e))}function P(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return O(e,t,(function(e,t){if(Array.isArray(e))return e.concat(t)}))}function x(e,t){return e===t?{}:m.a.isObject(e)&&m.a.isObject(t)?m.a.isDate(e)||m.a.isDate(t)?e.valueOf()===t.valueOf()?{}:t:Object.keys(t).reduce((function(n,a){if(!I(e,a))return y(y({},n),{},r()({},a,t[a]));if(m.a.isArray(t[a])){var i=N(e[a],t[a]);return Object.keys(i).length>0?y(y({},n),{},r()({},a,t[a])):n}if(m.a.isObject(t[a])){var s=x(e[a],t[a]);return!m.a.isObject(s)||Object.keys(s).length>0?y(y({},n),{},r()({},a,s)):n}return e[a]!==t[a]?y(y({},n),{},r()({},a,t[a])):n}),{}):t}function N(e,t){if(e===t)return[];if(!m.a.isArray(e)||!m.a.isArray(t))return t;if(e.length<=0&&t.length<=0)return[];if(e.length!==t.length)return t;if(!m.a.isObject(t[0]))return t.filter((function(t){return!e.includes(t)}));var n=[];return t.forEach((function(a,r){var i=x(e[r],t[r]);Object.keys(i).length>0&&n.push(t[r])})),n}},nKaH:function(e,t){e.exports='{% block releva_retargeting_statistic %}\n    <sw-page class="releva-retargeting-statistic">\n        <template slot="smart-bar-actions">\n            {% block releva_retargeting_statistic_actions %}\n                <sw-single-select\n                    v-if="salesChannelsToIframeUrl && salesChannelsToIframeUrl.length > 1"\n                    class="releva-frame-releva-sales-channel-switch"\n                    size="big" \n                    labelProperty="salesChannel"\n                    valueProperty="iframeUrl"\n                    @input="onSalesChannelsToIframeUrlSelectionChange"\n                    :value="currentIframeUrl"\n                    :options="salesChannelsToIframeUrl"\n                    :placeholder="$tc(\'releva-retargeting.config.relevaSalesChannelSwitch.label\')"\n                ></sw-single-select>\n            {% endblock %}\n        </template>\n        <template slot="content">\n            {% block releva_retargeting_statistic_content %}\n                <div v-if=\'currentIframeUrl\' class="releva-frame-container">\n                    <template>\n                        <iframe v-bind:src="currentIframeUrl" class="releva-frame-frame"></iframe>\n                    </template>\n                </div>\n            {% endblock %}\n        </template>\n    </sw-page>\n{% endblock %}\n'},sipW:function(e,t,n){var a=n("6Xru");"string"==typeof a&&(a=[[e.i,a,""]]),a.locals&&(e.exports=a.locals);(0,n("SZ7m").default)("50394b18",a,!0,{})}},[["SwDr","runtime","vendors-node"]]]);